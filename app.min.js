document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("monthsaryPreloader");e&&setTimeout(()=>{e.remove()},3200);let t=document.getElementById("bgAudio"),n=document.getElementById("playBtn"),l=document.getElementById("muteBtn");t&&n&&n.addEventListener("click",()=>{t.paused?(t.play().catch(()=>{}),n.textContent="⏸"):(t.pause(),n.textContent="⏯︎")}),t&&l&&l.addEventListener("click",()=>{t.muted=!t.muted,l.textContent=t.muted?"\uD83D\uDD07":"\uD83D\uDD08"});let s=["hero","lanterns","timeline","final","letter"];function a(e){s.forEach(e=>{let t=document.getElementById(e);t&&t.classList.add("hidden")});let t=document.getElementById(e);t&&t.classList.remove("hidden")}a("hero");let r=document.getElementById("letter");document.getElementById("blurOverlay");let i=document.getElementById("openEnvelopeBtn"),o=document.getElementById("paperSound"),d=document.getElementById("closeLetter"),c=document.getElementById("sendWish");i.addEventListener("click",()=>{if(r.classList.remove("hidden"),o){o.currentTime=0,o.volume=0,o.play().catch(()=>{});let e=0,l=setInterval(()=>{e+=.05,o.volume=Math.min(e,.35),e>=.35&&clearInterval(l)},40)}let s=document.getElementById("heartbeatAudio");if(s&&(s.volume=.55),t&&t.paused){t.volume=0,t.play().catch(()=>{}),n.textContent="⏸";let a=0,i=setInterval(()=>{a+=.05,t.volume=Math.min(a,1),a>=1&&clearInterval(i)},120)}}),d.addEventListener("click",()=>{r.classList.add("hidden")}),c.addEventListener("click",()=>{r.classList.add("hidden"),a("lanterns"),document.getElementById("lanternArea"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{$()})})});let m=document.getElementById("lanternArea");function $(){if(m){m.innerHTML="";for(let e=0;e<16;e++)setTimeout(()=>{let e=document.createElement("img");e.src="assets/lantern.png",e.className="lantern",e.style.left=`${8+84*Math.random()}%`,e.style.bottom="-180px",e.style.width=`${70+70*Math.random()}px`,e.style.position="absolute",e.style.opacity="0",m.appendChild(e),requestAnimationFrame(()=>{e.style.transition="transform 18s cubic-bezier(.25,.9,.25,1), opacity 1.8s",e.style.transform=`translateY(-${window.innerHeight+500}px)`,e.style.opacity="1"}),setTimeout(()=>e.remove(),16e3)},180*e)}}let y=document.getElementById("gotoTimelineBtn"),h=Array.from(document.querySelectorAll(".slide")),p=0;function g(e){h.forEach((t,n)=>t.classList.toggle("active",n===e))}y.addEventListener("click",()=>{a("timeline"),g(0)}),document.querySelectorAll(".nextSlide").forEach(e=>{e.addEventListener("click",()=>{g(p=Math.min(p+1,h.length-1))})});let f=document.getElementById("toFinal"),E=document.getElementById("finalLantern"),u=document.getElementById("finalMsg"),v=document.getElementById("restartBtn");function L(){for(let e=0;e<40;e++)setTimeout(()=>{let e=document.createElement("div");e.className="falling-heart",e.style.left=Math.random()*window.innerWidth+"px",e.style.top="-20px",document.body.appendChild(e),setTimeout(()=>e.remove(),7e3)},180*e)}f.addEventListener("click",()=>{a("final")}),E.addEventListener("click",()=>{E.style.transition="transform 3s ease, opacity 2s",E.style.transform="translateY(-220vh)",E.style.opacity="0";let e=document.querySelector(".heart.left"),t=document.querySelector(".heart.right"),n=document.querySelector(".heart.merged");setTimeout(()=>{e.classList.add("show"),t.classList.add("show")},800),setTimeout(()=>{e.classList.add("merge"),t.classList.add("merge")},2600),setTimeout(()=>{e.style.opacity="0",t.style.opacity="0",heartbeatAudio&&(heartbeatAudio.currentTime=0,heartbeatAudio.play().catch(()=>{})),setTimeout(()=>{n.style.opacity="1",n.classList.add("show")},300)},4200),setTimeout(()=>{L()},3400),setTimeout(()=>{u.classList.remove("hidden"),u.classList.add("show"),u.style.display="flex"},4200),setTimeout(()=>{let e=document.getElementById("loveLine");e&&(e.classList.remove("hidden"),e.classList.add("show"))},5400)}),v.addEventListener("click",()=>{p=0,g(0),u&&(u.classList.remove("show"),u.classList.add("hidden"),u.style.display="none",u.style.opacity="",u.style.transform=""),E&&(E.style.transition="none",E.style.transform="translateY(0)",E.style.opacity="1",E.offsetHeight,E.style.transition=""),m.innerHTML="",a("hero"),p=0,g(0),document.querySelectorAll(".heart").forEach(e=>{e.className=e.classList.contains("merged")?"heart merged":e.classList.contains("left")?"heart left":"heart right",e.style.opacity=""})});let B=document.getElementById("petals"),I=B.getContext("2d");function _(){B.width=innerWidth,B.height=innerHeight}_(),window.addEventListener("resize",_);let x=Array.from({length:30},()=>({x:Math.random()*B.width,y:Math.random()*B.height,r:6+10*Math.random(),s:.4+Math.random(),a:Math.random()*Math.PI*2}));function w(){I.clearRect(0,0,B.width,B.height),x.forEach(e=>{I.save(),I.translate(e.x,e.y),I.rotate(e.a),I.beginPath(),I.ellipse(0,0,e.r,.6*e.r,0,0,2*Math.PI),I.fillStyle="rgba(255,180,210,0.6)",I.fill(),I.restore(),e.y+=e.s,e.y>B.height&&(e.y=-20)}),requestAnimationFrame(w)}w()});const comet=document.getElementById("comet");if(comet){function e(){comet.style.transition="none",comet.style.transform="translateX(-300%)",comet.style.opacity=0,setTimeout(()=>{comet.style.transition="transform 6s linear, opacity 1s",comet.style.opacity=1,comet.style.transform="translateX(360%)"},300),setTimeout(e,9e3+4e3*Math.random())}e()}let lastHeartTime=0;function spawnCursorHeart(e,t){let n=Date.now();if(n-lastHeartTime<50)return;lastHeartTime=n;let l=document.createElement("div");l.className="cursor-heart",l.textContent="\uD83D\uDC96",l.style.left=e+"px",l.style.top=t+"px",document.body.appendChild(l),setTimeout(()=>{l.remove()},1400)}document.addEventListener("mousemove",e=>{spawnCursorHeart(e.clientX,e.clientY)}),document.addEventListener("touchmove",e=>{e.touches&&e.touches.length>0&&spawnCursorHeart(e.touches[0].clientX,e.touches[0].clientY)},{passive:!0});